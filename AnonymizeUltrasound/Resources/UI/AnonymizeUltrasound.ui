<?xml version="1.0" encoding="UTF-8"?>
<ui version="4.0">
  <class>AnonymizeUltrasound</class>
  <widget class="qMRMLWidget" name="AnonymizeUltrasound">
    <property name="geometry">
      <rect>
        <x>0</x>
        <y>0</y>
        <width>465</width>
        <height>771</height>
      </rect>
    </property>
    <layout class="QVBoxLayout" name="verticalLayout">
      <item>
        <widget class="ctkCollapsibleButton" name="inputsCollapsibleButton">
          <property name="text">
            <string>Folders for DICOM files</string>
          </property>
          <layout class="QFormLayout" name="formLayout_2">
            <item row="0" column="0">
              <widget class="QLabel" name="label">
                <property name="text">
                  <string>Input folder:</string>
                </property>
              </widget>
            </item>
            <item row="0" column="1">
              <widget class="ctkDirectoryButton" name="inputDirectoryButton">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>All DICOM files will be processed in this folder and all its subfolders</string>
                </property>
              </widget>
            </item>
            <item row="2" column="0">
              <widget class="QLabel" name="label_3">
                <property name="text">
                  <string>Output folder: </string>
                </property>
              </widget>
            </item>
            <item row="2" column="1">
              <widget class="ctkDirectoryButton" name="outputDirectoryButton">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Deidentified DICOM files will be saved here</string>
                </property>
              </widget>
            </item>
            <item row="4" column="0" colspan="2">
              <widget class="QPushButton" name="importDicomButton">
                <property name="minimumSize">
                  <size>
                    <width>0</width>
                    <height>40</height>
                  </size>
                </property>
                <property name="text">
                  <string>Import DICOM folder</string>
                </property>
              </widget>
            </item>
            <item row="3" column="0">
              <widget class="QLabel" name="label_6">
                <property name="text">
                  <string>Headers folder: </string>
                </property>
              </widget>
            </item>
            <item row="3" column="1">
              <widget class="ctkDirectoryButton" name="headersDirectoryButton">
                <property name="toolTip">
                  <string>Original DICOM headers will be saved here. May contain PHI!</string>
                </property>
              </widget>
            </item>
          </layout>
        </widget>
      </item>
      <item>
        <widget class="ctkCollapsibleButton" name="dataProcessingCollapsibleButton">
          <property name="text">
            <string>Processing</string>
          </property>
          <layout class="QFormLayout" name="formLayout_4">
            <item row="0" column="0">
              <widget class="QLabel" name="label_2">
                <property name="text">
                  <string>Patient ID:</string>
                </property>
              </widget>
            </item>
            <item row="0" column="1">
              <widget class="QLabel" name="patientIdLabel">
                <property name="text">
                  <string>current patient id</string>
                </property>
              </widget>
            </item>
            <item row="1" column="0">
              <widget class="QLabel" name="label_8">
                <property name="text">
                  <string>SOP Instance UID: </string>
                </property>
              </widget>
            </item>
            <item row="1" column="1">
              <widget class="QLabel" name="sopInstanceUidLabel">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Preferred">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="text">
                  <string>current SOP Instance UID</string>
                </property>
              </widget>
            </item>
            <item row="2" column="0">
              <widget class="QLabel" name="label_5">
                <property name="text">
                  <string>Patient Name Prefix (required): </string>
                </property>
              </widget>
            </item>
            <item row="2" column="1">
              <widget class="QLineEdit" name="namePrefixLineEdit">
                <property name="toolTip">
                  <string>All patient names will start with this text if Patient ID hashing is
                    selected. Required.</string>
                </property>
              </widget>
            </item>
            <item row="4" column="0">
              <widget class="QLabel" name="label_10">
                <property name="text">
                  <string>Progress: </string>
                </property>
              </widget>
            </item>
            <item row="4" column="1">
              <widget class="QProgressBar" name="progressBar">
                <property name="value">
                  <number>0</number>
                </property>
              </widget>
            </item>
            <item row="5" column="0" colspan="2">
              <layout class="QHBoxLayout" name="horizontalLayout">
                <item>
                  <widget class="QPushButton" name="prevButton">
                    <property name="minimumSize">
                      <size>
                        <width>0</width>
                        <height>40</height>
                      </size>
                    </property>
                    <property name="text">
                      <string>Previous [P]</string>
                    </property>
                  </widget>
                </item>
                <item>
                  <widget class="QPushButton" name="nextButton">
                    <property name="minimumSize">
                      <size>
                        <width>0</width>
                        <height>40</height>
                      </size>
                    </property>
                    <property name="text">
                      <string>Next [N]</string>
                    </property>
                  </widget>
                </item>
                <item>
                  <widget class="QPushButton" name="defineMaskButton">
                    <property name="minimumSize">
                      <size>
                        <width>0</width>
                        <height>40</height>
                      </size>
                    </property>
                    <property name="text">
                      <string>Mask [M]</string>
                    </property>
                    <property name="checkable">
                      <bool>true</bool>
                    </property>
                  </widget>
                </item>
                <item>
                  <widget class="QPushButton" name="exportButton">
                    <property name="minimumSize">
                      <size>
                        <width>0</width>
                        <height>40</height>
                      </size>
                    </property>
                    <property name="toolTip">
                      <string>Applies mask and exports anonymized DICOM file</string>
                    </property>
                    <property name="text">
                      <string>Export [E]</string>
                    </property>
                  </widget>
                </item>
                <item>
                  <widget class="QPushButton" name="exportAndNextButton">
                    <property name="minimumSize">
                      <size>
                        <width>0</width>
                        <height>40</height>
                      </size>
                    </property>
                    <property name="toolTip">
                      <string>Export and load next scan</string>
                    </property>
                    <property name="text">
                      <string>Export and Next [A]</string>
                    </property>
                  </widget>
                </item>
              </layout>
            </item>
          </layout>
        </widget>
      </item>
      <item>
        <widget class="ctkCollapsibleButton" name="labelsCollapsibleButton">
          <property name="text">
            <string>Annotation labels</string>
          </property>
          <layout class="QVBoxLayout" name="verticalLayout_4">
            <item>
              <widget class="QScrollArea" name="labelsScrollArea">
                <property name="widgetResizable">
                  <bool>true</bool>
                </property>
                <widget class="QWidget" name="labelsScrollAreaWidgetContents">
                  <property name="geometry">
                    <rect>
                      <x>0</x>
                      <y>0</y>
                      <width>425</width>
                      <height>60</height>
                    </rect>
                  </property>
                  <layout class="QVBoxLayout" name="verticalLayout_5"/>
                </widget>
              </widget>
            </item>
          </layout>
        </widget>
      </item>
      <item>
        <spacer name="verticalSpacer">
          <property name="orientation">
            <enum>Qt::Vertical</enum>
          </property>
          <property name="sizeType">
            <enum>QSizePolicy::Expanding</enum>
          </property>
          <property name="sizeHint" stdset="0">
            <size>
              <width>20</width>
              <height>10</height>
            </size>
          </property>
        </spacer>
      </item>
      <item>
        <widget class="QLabel" name="statusLabel">
          <property name="sizePolicy">
            <sizepolicy hsizetype="Ignored" vsizetype="Preferred">
              <horstretch>0</horstretch>
              <verstretch>0</verstretch>
            </sizepolicy>
          </property>
          <property name="font">
            <font>
              <weight>75</weight>
              <bold>true</bold>
            </font>
          </property>
          <property name="text">
            <string>Status label</string>
          </property>
        </widget>
      </item>
      <item>
        <widget class="ctkCollapsibleButton" name="settingsCollapsibleButton">
          <property name="text">
            <string>Settings</string>
          </property>
          <property name="collapsed">
            <bool>false</bool>
          </property>
          <layout class="QVBoxLayout" name="verticalLayout_2">
            <item>
              <widget class="QCheckBox" name="preserveDirectoryStructureCheckBox">
                <property name="text">
                  <string>Preserve input directory structure</string>
                </property>
                <property name="toolTip">
                  <string>When enabled, output files will maintain the same directory structure as
                    input files. When disabled, all files are saved to the root of the output
                    directory.</string>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="enableMaskCacheCheckBox">
                <property name="toolTip">
                  <string>If checked, cached mask will be used for DICOM transducer.</string>
                </property>
                <property name="text">
                  <string>Use cached mask</string>
                </property>
                <property name="invertThreshold" stdset="0">
                  <string/>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="autoMaskCheckBox">
                <property name="toolTip">
                  <string>If checked, values above threshold are set to 0. If unchecked, values
                    below are set to 0.</string>
                </property>
                <property name="text">
                  <string>Automatically suggest mask</string>
                </property>
                <property name="invertThreshold" stdset="0">
                  <string/>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="autoOverlayCheckBox">
                <property name="toolTip">
                  <string>If checked, show the automatic (red) overlay mask.</string>
                </property>
                <property name="text">
                  <string>Show automatic overlay</string>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="skipSingleframeCheckBox">
                <property name="text">
                  <string>Skip single-frame input DICOM files</string>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="continueProgressCheckBox">
                <property name="text">
                  <string>Continue progress (skip input if matching output exists)</string>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="hashPatientIdCheckBox">
                <property name="toolTip">
                  <string>Should only be unchecked if the input DICOM files are already have
                    anonymized headers</string>
                </property>
                <property name="text">
                  <string>Hash Patient ID (deidentify patient)</string>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="threePointFanCheckBox">
                <property name="toolTip">
                  <string>Allow defining a fan mask with 1 top point and 2 bottom points</string>
                </property>
                <property name="text">
                  <string>Enable 3-Point Fan Mask [C]</string>
                </property>
              </widget>
            </item>
            <item>
              <layout class="QVBoxLayout" name="verticalLayout_3">
                <item>
                  <widget class="QLabel" name="label_4">
                    <property name="text">
                      <string>Annotation labels CSV file:</string>
                    </property>
                  </widget>
                </item>
                <item>
                  <widget class="ctkPathLineEdit" name="labelsFileSelector"/>
                </item>
              </layout>
            </item>
            <item>
              <widget class="QCheckBox" name="enableAutoAnonymizeCheckBox">
                <property name="text">
                  <string>Enable Auto‑Anonymize</string>
                </property>
              </widget>
            </item>
            <item>
              <widget class="QCheckBox" name="enableModelEvaluationCheckBox">
                <property name="text">
                  <string>Enable Model Evaluation</string>
                </property>
              </widget>
            </item>
          </layout>
        </widget>
      </item>
      <item>
        <widget class="QGroupBox" name="autoAnonGroupBox">
          <property name="title">
            <string>Auto‑Anonymize</string>
          </property>
          <property name="visible">
            <bool>false</bool>
          </property>
          <layout class="QFormLayout" name="autoAnonFormLayout">
            <item row="0" column="0">
              <widget class="QLabel" name="label">
                <property name="text">
                  <string>Input folder:</string>
                </property>
              </widget>
            </item>
            <item row="0" column="1">
              <widget class="ctkDirectoryButton" name="inputDirectoryButtonBatch">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>All DICOM files will be processed in this folder and all its subfolders</string>
                </property>
              </widget>
            </item>
            <item row="2" column="0">
              <widget class="QLabel" name="label_3">
                <property name="text">
                  <string>Output folder: </string>
                </property>
              </widget>
            </item>
            <item row="2" column="1">
              <widget class="ctkDirectoryButton" name="outputDirectoryButtonBatch">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Deidentified DICOM files will be saved here</string>
                </property>
              </widget>
            </item>
            <item row="3" column="0">
              <widget class="QLabel" name="label_6">
                <property name="text">
                  <string>Headers folder: </string>
                </property>
              </widget>
            </item>
            <item row="3" column="1">
              <widget class="ctkDirectoryButton" name="headersDirectoryButtonBatch">
                <property name="toolTip">
                  <string>Original DICOM headers will be saved here. May contain PHI!</string>
                </property>
              </widget>
            </item>
            <item row="4" column="0">
              <widget class="QLabel" name="autoAnonModelPathLabel">
                <property name="text">
                  <string>Model path</string>
                </property>
                <property name="toolTip">
                  <string>Path to the model file</string>
                </property>
              </widget>
            </item>
            <item row="4" column="1">
              <widget class="ctkPathLineEdit" name="autoAnonModelPathButton">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Model path will be saved here. Select a model file.</string>
                </property>
              </widget>
            </item>
            <item row="5" column="0">
              <widget class="QLabel" name="autoAnonDeviceLabel">
                <property name="text">
                  <string>Device</string>
                </property>
                <property name="toolTip">
                  <string>Device to run the model on</string>
                </property>
              </widget>
            </item>
            <item row="5" column="1">
              <widget class="QComboBox" name="autoAnonDeviceComboBox">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Device to run the model on. GPU requires CUDA, MPS requires Apple Silicon
                    Mac.</string>
                </property>
                <item>
                  <property name="text">
                    <string>cpu</string>
                  </property>
                </item>
                <item>
                  <property name="text">
                    <string>mps</string>
                  </property>
                </item>
                <item>
                  <property name="text">
                    <string>cuda</string>
                  </property>
                </item>
              </widget>
            </item>
            <item row="6" column="0">
              <widget class="QLabel" name="topRatioLabel">
                <property name="text">
                  <string>Top redaction ratio:</string>
                </property>
                <property name="toolTip">
                  <string>Percentage of image height to redact from the top (0.0-1.0). Uses top fan
                    points as hints to avoid over-redaction.</string>
                </property>
              </widget>
            </item>
            <item row="6" column="1">
              <widget class="QDoubleSpinBox" name="topRatioSpinBox">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="minimum">
                  <double>0.000000000000000</double>
                </property>
                <property name="maximum">
                  <double>1.000000000000000</double>
                </property>
                <property name="singleStep">
                  <double>0.010000000000000</double>
                </property>
                <property name="value">
                  <double>0.100000000000000</double>
                </property>
                <property name="decimals">
                  <number>3</number>
                </property>
                <property name="toolTip">
                  <string>Percentage of image height to redact from the top (0.0-1.0). Uses top fan
                    points as hints to avoid over-redaction.</string>
                </property>
              </widget>
            </item>
            <item row="7" column="0">
              <widget class="QLabel" name="phiOnlyModeLabel">
                <property name="text">
                  <string>PHI-only mode:</string>
                </property>
                <property name="toolTip">
                  <string>If enabled, only applies top redaction without fan mask. Preserves the
                    full ultrasound image except for the top portion.</string>
                </property>
              </widget>
            </item>
            <item row="7" column="1">
              <widget class="QCheckBox" name="phiOnlyModeCheckBox">
                <property name="text">
                  <string>Remove PHI only (no fan mask)</string>
                </property>
                <property name="toolTip">
                  <string>If enabled, only applies top redaction without fan mask. Preserves the
                    full ultrasound image except for the top portion.</string>
                </property>
              </widget>
            </item>
            <item row="8" column="0">
              <widget class="QLabel" name="removePhiFromImageLabel">
                <property name="text">
                  <string>Remove PHI from image:</string>
                </property>
                <property name="toolTip">
                  <string>If enabled, applies PHI redaction to the image pixel data and generates
                    PDF with diff. If disabled, only removes PHI from DICOM metadata.</string>
                </property>
              </widget>
            </item>
            <item row="8" column="1">
              <widget class="QCheckBox" name="removePhiFromImageCheckBox">
                <property name="text">
                  <string>Remove PHI from image</string>
                </property>
                <property name="toolTip">
                  <string>If enabled, applies PHI redaction to the image pixel data and generates
                    PDF with diff. If disabled, only removes PHI from DICOM metadata.</string>
                </property>
              </widget>
            </item>
            <item row="9" column="0">
              <widget class="QLabel" name="overwriteFilesLabel">
                <property name="text">
                  <string>Overwrite existing files:</string>
                </property>
                <property name="toolTip">
                  <string>If enabled, overwrites existing output files. If disabled, skips files
                    that already exist.</string>
                </property>
              </widget>
            </item>
            <item row="9" column="1">
              <widget class="QCheckBox" name="overwriteFilesCheckBox">
                <property name="text">
                  <string>Overwrite existing files</string>
                </property>
                <property name="toolTip">
                  <string>If enabled, overwrites existing output files. If disabled, skips files
                    that already exist.</string>
                </property>
              </widget>
            </item>
            <item row="10" column="0" colspan="2">
              <widget class="QPushButton" name="runAutoAnonymizeButton">
                <property name="text">
                  <string>Run Auto‑Anonymize</string>
                </property>
                <property name="toolTip">
                  <string>Run Auto‑Anonymize (Batch) for all DICOM files in the input folder</string>
                </property>
              </widget>
            </item>
          </layout>
        </widget>
      </item>
      <item>
        <widget class="QGroupBox" name="modelEvaluationGroupBox">
          <property name="title">
            <string>Model Evaluation</string>
          </property>
          <property name="visible">
            <bool>false</bool>
          </property>
          <layout class="QFormLayout" name="modelEvaluationFormLayout">
            <item row="0" column="0">
              <widget class="QLabel" name="modelEvaluationInputLabel">
                <property name="text">
                  <string>Input folder:</string>
                </property>
              </widget>
            </item>
            <item row="0" column="1">
              <widget class="ctkDirectoryButton" name="inputDirectoryButtonEval">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>All DICOM files will be processed in this folder and all its subfolders</string>
                </property>
              </widget>
            </item>
            <item row="2" column="0">
              <widget class="QLabel" name="modelEvaluationModelPathLabel">
                <property name="text">
                  <string>Model path</string>
                </property>
                <property name="toolTip">
                  <string>Path to the model file</string>
                </property>
              </widget>
            </item>
            <item row="2" column="1">
              <widget class="ctkPathLineEdit" name="modelEvaluationModelPathButton">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Model path will be saved here. Select a model file.</string>
                </property>
              </widget>
            </item>
            <item row="3" column="0">
              <widget class="QLabel" name="modelEvaluationDeviceLabel">
                <property name="text">
                  <string>Device</string>
                </property>
                <property name="toolTip">
                  <string>Device to run the model on</string>
                </property>
              </widget>
            </item>
            <item row="3" column="1">
              <widget class="QComboBox" name="modelEvaluationDeviceComboBox">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Device to run the model on. GPU requires CUDA, MPS requires Apple Silicon
                    Mac.</string>
                </property>
                <item>
                  <property name="text">
                    <string>cpu</string>
                  </property>
                </item>
                <item>
                  <property name="text">
                    <string>mps</string>
                  </property>
                </item>
                <item>
                  <property name="text">
                    <string>cuda</string>
                  </property>
                </item>
              </widget>
            </item>
            <item row="4" column="0">
              <widget class="QLabel" name="modelEvaluationOverviewLabel">
                <property name="text">
                  <string>Overview dir</string>
                </property>
                <property name="toolTip">
                  <string>Directory to save the overview files</string>
                </property>
              </widget>
            </item>
            <item row="4" column="1">
              <widget class="ctkDirectoryButton" name="modelEvaluationOverviewDirButton">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Overview directory will be saved here</string>
                </property>
              </widget>
            </item>
            <item row="5" column="0">
              <widget class="QLabel" name="modelEvaluationGroundTruthLabel">
                <property name="text">
                  <string>Ground truth dir</string>
                </property>
                <property name="toolTip">
                  <string>Directory of JSON mask configs matching anonymized DICOM filenames</string>
                </property>
              </widget>
            </item>
            <item row="5" column="1">
              <widget class="ctkDirectoryButton" name="modelEvaluationGroundTruthButton">
                <property name="sizePolicy">
                  <sizepolicy hsizetype="Ignored" vsizetype="Fixed">
                    <horstretch>0</horstretch>
                    <verstretch>0</verstretch>
                  </sizepolicy>
                </property>
                <property name="toolTip">
                  <string>Ground truth directory will be saved here</string>
                </property>
              </widget>
            </item>
            <item row="6" column="0" colspan="2">
              <widget class="QPushButton" name="runModelEvaluationButton">
                <property name="text">
                  <string>Run Model Evaluation</string>
                </property>
                <property name="toolTip">
                  <string>Run Model Evaluation (Batch) for all DICOM files in the input folder</string>
                </property>
              </widget>
            </item>
          </layout>
        </widget>
      </item>
    </layout>
  </widget>
</ui>
